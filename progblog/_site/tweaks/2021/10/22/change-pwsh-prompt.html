<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/mousetrap/1.4.6/mousetrap.min.js"></script>
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/progblog/css/searchoverlay.css" rel="stylesheet"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Customizing the Powershell Prompt | ProgBlog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Customizing the Powershell Prompt" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Initially I was scanning through Google as usual and found some solutions. The key idea was taken from this SOF thread. One needs to use Virtual Terminal Sequences to do this. Using Virtual Terminal Sequences: From the Microsoft documentation on this: Virtual terminal sequences are control character sequences that can control cursor movement, color/font mode, and other operations when written to the output stream. We’re interested in color/font mode to change the appearance of our prompt. We need a sequence of the format ESC[&lt;n&gt;m There are two parts to this: We need to the start with the ASCII ESC character (hex 0x1B). This can be achieved by writing the expression $([char]27) in Powershell. For &lt;n&gt; we insert an appropriate integer code that corresponds to a particular formatting style. The entire list can be found in the same doc page. When we combine the two parts, we write something like: $([char]27)[36m which applies non-bold/bright cyan to foreground. The text that follows will acquire this style. To negate all styles we use ESC[0m. Custom colours: With ESC[38;2;&lt;r&gt;;&lt;g&gt;;&lt;b&gt;m(ESC[48;...) one can use any (r, g, b) value for the text foreground (background). For instance, (250, 128, 114) is the salmon colour. Changing the prompt permanently We modify the Powershell profile file to make changes permanent. (Creating profiles) We add the following lines: $ESC = [char]27 function prompt { $(if (Test-Path variable:/PSDebugContext) { &#39;[DBG]: &#39; } else { &#39;&#39; }) + &quot;$ESC[38;2;250;128;114mPS@$ESC[38;2;127;255;255m$ESC[4m&quot; + $(Get-Location) + &quot;$ESC[24m&quot; + $(if ($NestedPromptLevel -ge 1) { &#39;&gt;&gt;&#39; }) + &quot;&gt; $ESC[0m&quot; } where We have stored the ESC character in a variable to ease our life. The prompt() function is used to modify the prompt. The code within the prompt() function has been obtained from the doc on Powershell prompt. The built-in prompt has been modified1 by inserting sequences at appropriate places. Currently, it should look like this: For changes to take effect immediately, source the profile using . $profile. The original SOF solution (and many other places) give this solution: function prompt { &quot;$ESC[93mPS $ESC[36m$($executionContext.SessionState.Path.CurrentLocation)$(&#39;&gt;&#39; * ($nestedPromptLevel + 1)) $ESC[0m&quot; } but $(&#39;&gt;&#39; * ($nestedPromptLevel + 1)) causes issues. More specifically, the character m appeared automatically after the prompt when I was typing a period . which is undesirable behaviour. TO BE INVESTIGATED. &#8617;" />
<meta property="og:description" content="Initially I was scanning through Google as usual and found some solutions. The key idea was taken from this SOF thread. One needs to use Virtual Terminal Sequences to do this. Using Virtual Terminal Sequences: From the Microsoft documentation on this: Virtual terminal sequences are control character sequences that can control cursor movement, color/font mode, and other operations when written to the output stream. We’re interested in color/font mode to change the appearance of our prompt. We need a sequence of the format ESC[&lt;n&gt;m There are two parts to this: We need to the start with the ASCII ESC character (hex 0x1B). This can be achieved by writing the expression $([char]27) in Powershell. For &lt;n&gt; we insert an appropriate integer code that corresponds to a particular formatting style. The entire list can be found in the same doc page. When we combine the two parts, we write something like: $([char]27)[36m which applies non-bold/bright cyan to foreground. The text that follows will acquire this style. To negate all styles we use ESC[0m. Custom colours: With ESC[38;2;&lt;r&gt;;&lt;g&gt;;&lt;b&gt;m(ESC[48;...) one can use any (r, g, b) value for the text foreground (background). For instance, (250, 128, 114) is the salmon colour. Changing the prompt permanently We modify the Powershell profile file to make changes permanent. (Creating profiles) We add the following lines: $ESC = [char]27 function prompt { $(if (Test-Path variable:/PSDebugContext) { &#39;[DBG]: &#39; } else { &#39;&#39; }) + &quot;$ESC[38;2;250;128;114mPS@$ESC[38;2;127;255;255m$ESC[4m&quot; + $(Get-Location) + &quot;$ESC[24m&quot; + $(if ($NestedPromptLevel -ge 1) { &#39;&gt;&gt;&#39; }) + &quot;&gt; $ESC[0m&quot; } where We have stored the ESC character in a variable to ease our life. The prompt() function is used to modify the prompt. The code within the prompt() function has been obtained from the doc on Powershell prompt. The built-in prompt has been modified1 by inserting sequences at appropriate places. Currently, it should look like this: For changes to take effect immediately, source the profile using . $profile. The original SOF solution (and many other places) give this solution: function prompt { &quot;$ESC[93mPS $ESC[36m$($executionContext.SessionState.Path.CurrentLocation)$(&#39;&gt;&#39; * ($nestedPromptLevel + 1)) $ESC[0m&quot; } but $(&#39;&gt;&#39; * ($nestedPromptLevel + 1)) causes issues. More specifically, the character m appeared automatically after the prompt when I was typing a period . which is undesirable behaviour. TO BE INVESTIGATED. &#8617;" />
<link rel="canonical" href="http://localhost:4000/progblog/tweaks/2021/10/22/change-pwsh-prompt.html" />
<meta property="og:url" content="http://localhost:4000/progblog/tweaks/2021/10/22/change-pwsh-prompt.html" />
<meta property="og:site_name" content="ProgBlog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-10-22T15:30:00+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Customizing the Powershell Prompt" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://localhost:4000/progblog/tweaks/2021/10/22/change-pwsh-prompt.html","headline":"Customizing the Powershell Prompt","dateModified":"2021-10-22T15:30:00+05:30","datePublished":"2021-10-22T15:30:00+05:30","description":"Initially I was scanning through Google as usual and found some solutions. The key idea was taken from this SOF thread. One needs to use Virtual Terminal Sequences to do this. Using Virtual Terminal Sequences: From the Microsoft documentation on this: Virtual terminal sequences are control character sequences that can control cursor movement, color/font mode, and other operations when written to the output stream. We’re interested in color/font mode to change the appearance of our prompt. We need a sequence of the format ESC[&lt;n&gt;m There are two parts to this: We need to the start with the ASCII ESC character (hex 0x1B). This can be achieved by writing the expression $([char]27) in Powershell. For &lt;n&gt; we insert an appropriate integer code that corresponds to a particular formatting style. The entire list can be found in the same doc page. When we combine the two parts, we write something like: $([char]27)[36m which applies non-bold/bright cyan to foreground. The text that follows will acquire this style. To negate all styles we use ESC[0m. Custom colours: With ESC[38;2;&lt;r&gt;;&lt;g&gt;;&lt;b&gt;m(ESC[48;...) one can use any (r, g, b) value for the text foreground (background). For instance, (250, 128, 114) is the salmon colour. Changing the prompt permanently We modify the Powershell profile file to make changes permanent. (Creating profiles) We add the following lines: $ESC = [char]27 function prompt { $(if (Test-Path variable:/PSDebugContext) { &#39;[DBG]: &#39; } else { &#39;&#39; }) + &quot;$ESC[38;2;250;128;114mPS@$ESC[38;2;127;255;255m$ESC[4m&quot; + $(Get-Location) + &quot;$ESC[24m&quot; + $(if ($NestedPromptLevel -ge 1) { &#39;&gt;&gt;&#39; }) + &quot;&gt; $ESC[0m&quot; } where We have stored the ESC character in a variable to ease our life. The prompt() function is used to modify the prompt. The code within the prompt() function has been obtained from the doc on Powershell prompt. The built-in prompt has been modified1 by inserting sequences at appropriate places. Currently, it should look like this: For changes to take effect immediately, source the profile using . $profile. The original SOF solution (and many other places) give this solution: function prompt { &quot;$ESC[93mPS $ESC[36m$($executionContext.SessionState.Path.CurrentLocation)$(&#39;&gt;&#39; * ($nestedPromptLevel + 1)) $ESC[0m&quot; } but $(&#39;&gt;&#39; * ($nestedPromptLevel + 1)) causes issues. More specifically, the character m appeared automatically after the prompt when I was typing a period . which is undesirable behaviour. TO BE INVESTIGATED. &#8617;","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/progblog/tweaks/2021/10/22/change-pwsh-prompt.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/progblog/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/progblog/feed.xml" title="ProgBlog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/progblog/">ProgBlog</a>

    <script>
      $(document).ready(function() {
      $('#close-btn').click(function() {
        $('#search-overlay').fadeOut();
        $('#search-btn').show();
      });
      $('#search-btn').click(function() {
        $(this).hide();
        $('#search-overlay').fadeIn();
      });
    });
    </script>
    
    <i id="search-btn" class="fa fa-search fa-2x"></i>
    <div id="search-overlay" class="block">
      <div class="centered">
        <!-- <div id='search-box'>
          <i id="close-btn" class="fa fa-times fa-2x"></i>
          <form action='/search' id='search-form' method='get' target='_top'>
            <input id='search-text' name='q' placeholder='Search' type='text' />
            <button id='search-button' type='submit'>                     
              <i id="search-btn" class="fa fa-search fa-2x"></i>
            </button>
          </form>
        </div> -->

        <!-- Html Elements for Search -->
        <div id="search-box">
          <i id="close-btn" class="fa fa-times fa-2x"></i>
          <input type="text" id="search-input" class="mousetrap" placeholder="Start searching...">
          <ul id="results-container"></ul>
        </div>
      </div>
    </div>
    <!-- Script pointing to search-script.js -->
    <script src="/progblog/js/search-script.js" type="text/javascript"></script>

    <!-- Configuration -->
    <script>
    var srch = SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('results-container'),
      json: '/progblog/search.json',
      searchResultTemplate: `
      <li>
        <div style="display:inline"><a href="{url}" title="{desc}">{title}</a></div>
        <div style="width:20%; float:right; border-left:2px solid #777"><span style="padding-left: 5px; opacity:0.75">{category}</span></div>
      </li>
      `
    })
    </script>

    <!-- Custom keybind to search -->
    <script>
      function showSearch() {
        if($('#close-btn').is(":hidden")) {
          $('#search-btn').click();
          $('#search-input').focus();
        }
      }
      function hideSearch() {
        if($('#search-btn').is(":hidden")) {
          $('#close-btn').click();
        }
      }
      Mousetrap.bind(['command+shift+f', 'ctrl+shift+f'], showSearch);
      Mousetrap.bind(['escape'], hideSearch);
    </script>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Customizing the Powershell Prompt</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-10-22T15:30:00+05:30" itemprop="datePublished">Oct 22, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Initially I was scanning through Google as usual and found some solutions. The key idea was taken from <a href="https://superuser.com/a/1259916/1171201">this SOF thread</a>. One needs to use <em>Virtual Terminal Sequences</em> to do this.</p>

<h3 id="using-virtual-terminal-sequences">Using <em>Virtual Terminal Sequences</em>:</h3>

<p>From the Microsoft documentation on <a href="https://docs.microsoft.com/en-us/windows/console/console-virtual-terminal-sequences">this</a>:</p>

<blockquote>
  <p><strong>Virtual terminal sequences</strong> are control character sequences that can control cursor movement, color/font mode, and other operations when written to the output stream.</p>
</blockquote>

<p>We’re interested in <strong>color/font mode</strong> to change the appearance of our prompt. We need a sequence of the format</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ESC[&lt;n&gt;m
</code></pre></div></div>
<p>There are two parts to this:</p>
<ul>
  <li>We need to the start with the <em>ASCII ESC character</em> (hex 0x1B). This can be achieved by writing the expression <code class="language-plaintext highlighter-rouge">$([char]27)</code> in Powershell.</li>
  <li>For <code class="language-plaintext highlighter-rouge">&lt;n&gt;</code> we insert an appropriate integer code that corresponds to a particular formatting style. The entire list can be found in the same <a href="https://docs.microsoft.com/en-us/windows/console/console-virtual-terminal-sequences#text-formatting">doc page</a>.</li>
</ul>

<p>When we combine the two parts, we write something like:</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span><span class="p">([</span><span class="n">char</span><span class="p">]</span><span class="mi">27</span><span class="p">)[</span><span class="mi">36</span><span class="n">m</span><span class="w">
</span></code></pre></div></div>
<p>which applies <em>non-bold/bright <span style="color:rgb(88,209,235)"><strong>cyan</strong></span> to foreground</em>. The text that follows will acquire this style. To negate all styles we use <code class="language-plaintext highlighter-rouge">ESC[0m</code>.</p>

<h4 id="custom-colours">Custom colours:</h4>

<p>With <code class="language-plaintext highlighter-rouge">ESC[38;2;&lt;r&gt;;&lt;g&gt;;&lt;b&gt;m</code>(<code class="language-plaintext highlighter-rouge">ESC[48;...</code>) one can use any <em>(r, g, b)</em> value for the text foreground (background). For instance, <em>(250, 128, 114)</em> is the <span style="color:rgb(250,128,114)"><strong>salmon</strong></span> colour.</p>

<h3 id="changing-the-prompt-permanently">Changing the prompt permanently</h3>

<p>We modify the Powershell <em>profile</em> file to make changes permanent. (<a href="/progblog/tweaks/2021/10/22/pwsh-profile.html">Creating profiles</a>) We add the following lines:</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ESC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">char</span><span class="p">]</span><span class="mi">27</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">prompt</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">$</span><span class="p">(</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nx">variable:/PSDebugContext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">'[DBG]: '</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"</span><span class="nv">$ESC</span><span class="s2">[38;2;250;128;114mPS@</span><span class="nv">$ESC</span><span class="s2">[38;2;127;255;255m</span><span class="nv">$ESC</span><span class="s2">[4m"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="n">Get-Location</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"</span><span class="nv">$ESC</span><span class="s2">[24m"</span><span class="w"> </span><span class="o">+</span><span class="w">
        </span><span class="err">$</span><span class="p">(</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="bp">$NestedPromptLevel</span><span class="w"> </span><span class="o">-ge</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">'&gt;&gt;'</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"&gt; </span><span class="nv">$ESC</span><span class="s2">[0m"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>where</p>
<ul>
  <li>We have stored the <em>ESC</em> character in a variable to ease our life.</li>
  <li>The <code class="language-plaintext highlighter-rouge">prompt()</code> function is used to modify the prompt. The code within the <code class="language-plaintext highlighter-rouge">prompt()</code> function has been obtained from the <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_prompts?view=powershell-7.1#built-in-prompt">doc</a> on Powershell prompt.</li>
  <li>The <em>built-in prompt</em> has been modified<sup id="fnref:wrongsol" role="doc-noteref"><a href="#fn:wrongsol" class="footnote" rel="footnote">1</a></sup> by inserting sequences at appropriate places. Currently, it should look like this:</li>
</ul>

<p><img src="/res/pwsh_prompt_211022/newprompt.png" alt="" /></p>

<p>For changes to take effect immediately, source the profile using <code class="language-plaintext highlighter-rouge">. $profile</code>.</p>

<hr />

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:wrongsol" role="doc-endnote">
      <p>The original SOF solution (and many other places) give this solution:</p>
      <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">function</span><span class="w"> </span><span class="nf">prompt</span><span class="w">  
</span><span class="p">{</span><span class="w">  
    </span><span class="s2">"</span><span class="nv">$ESC</span><span class="s2">[93mPS </span><span class="nv">$ESC</span><span class="s2">[36m</span><span class="si">$(</span><span class="nv">$executionContext</span><span class="o">.</span><span class="nf">SessionState</span><span class="o">.</span><span class="nf">Path</span><span class="o">.</span><span class="nf">CurrentLocation</span><span class="si">)$(</span><span class="s1">'&gt;'</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nv">$nestedPromptLevel</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">)</span><span class="s2">) </span><span class="nv">$ESC</span><span class="s2">[0m"</span><span class="w">  
</span><span class="p">}</span><span class="w">
</span></code></pre></div>      </div>
      <p>but <code class="language-plaintext highlighter-rouge">$('&gt;' * ($nestedPromptLevel + 1))</code> causes issues. More specifically, the character <strong>m</strong> appeared automatically after the prompt when I was typing a period <code class="language-plaintext highlighter-rouge">.</code> which is undesirable behaviour. <span style="color:red"><em>TO BE INVESTIGATED.</em></span> <a href="#fnref:wrongsol" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div><a class="u-url" href="/progblog/tweaks/2021/10/22/change-pwsh-prompt.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/progblog/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">ProgBlog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">ProgBlog</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/amzon-ex"><svg class="svg-icon"><use xlink:href="/progblog/assets/minima-social-icons.svg#github"></use></svg> <span class="username">amzon-ex</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A blog documenting progress</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
